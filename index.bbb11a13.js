let e,t;function r(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var n=globalThis,a={},i={},o=n.parcelRequire3abd;null==o&&((o=function(e){if(e in a)return a[e].exports;if(e in i){var t=i[e];delete i[e];var r={id:e,exports:{}};return a[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){i[e]=t},n.parcelRequire3abd=o);var s=o.register;s("qgTqt",function(e,t){let n,a,i;r(e.exports,"FBXLoader",()=>c);var s=o("ilwiq"),l=o("79Zxq"),u=o("cLt9Z");class c extends s.Loader{constructor(e){super(e)}load(e,t,r,n){let a=this,i=""===a.path?(0,s.LoaderUtils).extractUrlBase(e):a.path,o=new s.FileLoader(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(r){try{t(a.parse(r,i))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e,t){if(function(e){let t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===M(e,0,t.length)}(e))n=new m().parse(e);else{let t=M(e);if(!function(e){let t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;for(let n=0;n<t.length;++n)if(function(t){let n=e[0];return e=e.slice(r+1),r++,n}(0)===t[n])return!1;return!0}(t))throw Error("THREE.FBXLoader: Unknown format.");if(7e3>y(t))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+y(t));n=new d().parse(t)}return new p(new(0,s.TextureLoader)(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),this.manager).parse(n)}}class p{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){a=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),n=this.parseDeformers(),o=new f().parse(n);return this.parseScene(n,o,r),i}parseConnections(){let e=new Map;return"Connections"in n&&n.Connections.connections.forEach(function(t){let r=t[0],n=t[1],a=t[2];e.has(r)||e.set(r,{parents:[],children:[]}),e.get(r).parents.push({ID:n,relationship:a}),e.has(n)||e.set(n,{parents:[],children:[]}),e.get(n).children.push({ID:r,relationship:a})}),e}parseImages(){let e={},t={};if("Video"in n.Objects){let r=n.Objects.Video;for(let n in r){let a=r[n];if(e[parseInt(n)]=a.RelativeFilename||a.Filename,"Content"in a){let e=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,i="string"==typeof a.Content&&""!==a.Content;if(e||i){let e=this.parseImage(r[n]);t[a.RelativeFilename||a.Filename]=e}}}}for(let r in e){let n=e[r];void 0!==t[n]?e[r]=t[n]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){let t;let r=e.Content,n=e.RelativeFilename||e.Filename,a=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),t="image/tga";break;default:console.warn('FBXLoader: Image type "'+a+'" is not supported.');return}if("string"==typeof r)return"data:"+t+";base64,"+r;{let e=new Uint8Array(r);return window.URL.createObjectURL(new Blob([e],{type:t}))}}parseTextures(e){let t=new Map;if("Texture"in n.Objects){let r=n.Objects.Texture;for(let n in r){let a=this.parseTexture(r[n],e);t.set(parseInt(n),a)}}return t}parseTexture(e,t){let r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;let n=e.WrapModeU,a=e.WrapModeV,i=void 0!==n?n.value:0,o=void 0!==a?a.value:0;if(r.wrapS=0===i?s.RepeatWrapping:s.ClampToEdgeWrapping,r.wrapT=0===o?s.RepeatWrapping:s.ClampToEdgeWrapping,"Scaling"in e){let t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}if("Translation"in e){let t=e.Translation.value;r.offset.x=t[0],r.offset.y=t[1]}return r}loadTexture(e,t){let r,n;let i=this.textureLoader.path,o=a.get(e.id).children;void 0!==o&&o.length>0&&void 0!==t[o[0].ID]&&(0===(r=t[o[0].ID]).indexOf("blob:")||0===r.indexOf("data:"))&&this.textureLoader.setPath(void 0);let l=e.FileName.slice(-3).toLowerCase();if("tga"===l){let t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),n=new s.Texture):(t.setPath(this.textureLoader.path),n=t.load(r))}else"psd"===l?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),n=new s.Texture):n=this.textureLoader.load(r);return this.textureLoader.setPath(i),n}parseMaterials(e){let t=new Map;if("Material"in n.Objects){let r=n.Objects.Material;for(let n in r){let a=this.parseMaterial(r[n],e);null!==a&&t.set(parseInt(n),a)}}return t}parseMaterial(e,t){let r;let n=e.id,i=e.attrName,o=e.ShadingModel;if("object"==typeof o&&(o=o.value),!a.has(n))return null;let l=this.parseParameters(e,t,n);switch(o.toLowerCase()){case"phong":r=new s.MeshPhongMaterial;break;case"lambert":r=new s.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),r=new s.MeshPhongMaterial}return r.setValues(l),r.name=i,r}parseParameters(e,t,r){let n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=new(0,s.Color)().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&("Color"===e.DiffuseColor.type||"ColorRGB"===e.DiffuseColor.type)&&(n.color=new(0,s.Color)().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=new(0,s.Color)().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&("Color"===e.EmissiveColor.type||"ColorRGB"===e.EmissiveColor.type)&&(n.emissive=new(0,s.Color)().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=new(0,s.Color)().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&"Color"===e.SpecularColor.type&&(n.specular=new(0,s.Color)().fromArray(e.SpecularColor.value).convertSRGBToLinear());let i=this;return a.get(r).children.forEach(function(e){let r=e.relationship;switch(r){case"Bump":n.bumpMap=i.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":n.aoMap=i.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=i.getTexture(t,e.ID),void 0!==n.map&&(n.map.encoding=s.sRGBEncoding);break;case"DisplacementColor":n.displacementMap=i.getTexture(t,e.ID);break;case"EmissiveColor":n.emissiveMap=i.getTexture(t,e.ID),void 0!==n.emissiveMap&&(n.emissiveMap.encoding=s.sRGBEncoding);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=i.getTexture(t,e.ID);break;case"ReflectionColor":n.envMap=i.getTexture(t,e.ID),void 0!==n.envMap&&(n.envMap.mapping=s.EquirectangularReflectionMapping,n.envMap.encoding=s.sRGBEncoding);break;case"SpecularColor":n.specularMap=i.getTexture(t,e.ID),void 0!==n.specularMap&&(n.specularMap.encoding=s.sRGBEncoding);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=i.getTexture(t,e.ID),n.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}}),n}getTexture(e,t){return"LayeredTexture"in n.Objects&&t in n.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=a.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in n.Objects){let r=n.Objects.Deformer;for(let n in r){let i=r[n],o=a.get(parseInt(n));if("Skin"===i.attrType){let t=this.parseSkeleton(o,r);t.ID=n,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=o.parents[0].ID,e[n]=t}else if("BlendShape"===i.attrType){let e={id:n};e.rawTargets=this.parseMorphTargets(o,r),e.id=n,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let r=[];return e.children.forEach(function(e){let n=t[e.ID];if("Cluster"!==n.attrType)return;let a={ID:e.ID,indices:[],weights:[],transformLink:new(0,s.Matrix4)().fromArray(n.TransformLink.a)};"Indexes"in n&&(a.indices=n.Indexes.a,a.weights=n.Weights.a),r.push(a)}),{rawBones:r,bones:[]}}parseMorphTargets(e,t){let r=[];for(let n=0;n<e.children.length;n++){let i=e.children[n],o=t[i.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=a.get(parseInt(i.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,r.push(s)}return r}parseScene(e,t,r){i=new s.Group;let o=this.parseModels(e.skeletons,t,r),l=n.Objects.Model,u=this;o.forEach(function(e){let t=l[e.ID];u.setLookAtProperties(e,t),a.get(e.ID).parents.forEach(function(t){let r=o.get(t.ID);void 0!==r&&r.add(e)}),null===e.parent&&i.add(e)}),this.bindSkeleton(e.skeletons,t,o),this.createAmbientLight(),i.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let t=E(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});let c=new h().parse();1===i.children.length&&i.children[0].isGroup&&(i.children[0].animations=c,i=i.children[0]),i.animations=c}parseModels(e,t,r){let i=new Map,o=n.Objects.Model;for(let n in o){let l=parseInt(n),u=o[n],c=a.get(l),p=this.buildSkeleton(c,e,l,u.attrName);if(!p){switch(u.attrType){case"Camera":p=this.createCamera(c);break;case"Light":p=this.createLight(c);break;case"Mesh":p=this.createMesh(c,t,r);break;case"NurbsCurve":p=this.createCurve(c,t);break;case"LimbNode":case"Root":p=new s.Bone;break;default:p=new s.Group}p.name=u.attrName?(0,s.PropertyBinding).sanitizeNodeName(u.attrName):"",p.ID=l}this.getTransformData(p,u),i.set(l,p)}return i}buildSkeleton(e,t,r,n){let a=null;return e.parents.forEach(function(e){for(let i in t){let o=t[i];o.rawBones.forEach(function(t,i){if(t.ID===e.ID){let e=a;(a=new s.Bone).matrixWorld.copy(t.transformLink),a.name=n?(0,s.PropertyBinding).sanitizeNodeName(n):"",a.ID=r,o.bones[i]=a,null!==e&&a.add(e)}})}}),a}createCamera(e){let t,r;if(e.children.forEach(function(e){let t=n.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new s.Object3D;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let n=1;void 0!==r.NearPlane&&(n=r.NearPlane.value/1e3);let a=1e3;void 0!==r.FarPlane&&(a=r.FarPlane.value/1e3);let i=window.innerWidth,o=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(i=r.AspectWidth.value,o=r.AspectHeight.value);let l=i/o,u=45;void 0!==r.FieldOfView&&(u=r.FieldOfView.value);let c=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new s.PerspectiveCamera(u,l,n,a),null!==c&&t.setFocalLength(c);break;case 1:t=new s.OrthographicCamera(-i/2,i/2,o/2,-o/2,n,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new s.Object3D}}return t}createLight(e){let t,r;if(e.children.forEach(function(e){let t=n.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new s.Object3D;else{let e;e=void 0===r.LightType?0:r.LightType.value;let n=0xffffff;void 0!==r.Color&&(n=new(0,s.Color)().fromArray(r.Color.value).convertSRGBToLinear());let a=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(a=0);let i=0;switch(void 0!==r.FarAttenuationEnd&&(i=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value),e){case 0:t=new s.PointLight(n,a,i,1);break;case 1:t=new s.DirectionalLight(n,a);break;case 2:let o=Math.PI/3;void 0!==r.InnerAngle&&(o=(0,s.MathUtils).degToRad(r.InnerAngle.value));let l=0;void 0!==r.OuterAngle&&(l=Math.max(l=(0,s.MathUtils).degToRad(r.OuterAngle.value),1)),t=new s.SpotLight(n,a,i,o,l,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new s.PointLight(n,a)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let n;let a=null,i=null,o=[];return e.children.forEach(function(e){t.has(e.ID)&&(a=t.get(e.ID)),r.has(e.ID)&&o.push(r.get(e.ID))}),o.length>1?i=o:o.length>0?i=o[0]:(i=new s.MeshPhongMaterial({color:0xcccccc}),o.push(i)),"color"in a.attributes&&o.forEach(function(e){e.vertexColors=!0}),a.FBX_Deformer?(n=new s.SkinnedMesh(a,i)).normalizeSkinWeights():n=new s.Mesh(a,i),n}createCurve(e,t){let r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),n=new s.LineBasicMaterial({color:3342591,linewidth:1});return new s.Line(r,n)}getTransformData(e,t){let r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?r.eulerOrder=L(t.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&a.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){let r=n.Objects.Model[t.ID];if("Lcl_Translation"in r){let t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),i.add(e.target)):e.lookAt(new(0,s.Vector3)().fromArray(t))}}})}bindSkeleton(e,t,r){let n=this.parsePoseNodes();for(let i in e){let o=e[i];a.get(parseInt(o.ID)).parents.forEach(function(e){if(t.has(e.ID)){let t=e.ID;a.get(t).parents.forEach(function(e){r.has(e.ID)&&r.get(e.ID).bind(new s.Skeleton(o.bones),n[e.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in n.Objects){let t=n.Objects.Pose;for(let r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){let n=t[r].PoseNode;Array.isArray(n)?n.forEach(function(t){e[t.Node]=new(0,s.Matrix4)().fromArray(t.Matrix.a)}):e[n.Node]=new(0,s.Matrix4)().fromArray(n.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in n&&"AmbientColor"in n.GlobalSettings){let e=n.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],a=e[2];if(0!==t||0!==r||0!==a){let e=new(0,s.Color)(t,r,a).convertSRGBToLinear();i.add(new s.AmbientLight(e,1))}}}}class f{constructor(){this.negativeMaterialIndices=!1}parse(e){let t=new Map;if("Geometry"in n.Objects){let r=n.Objects.Geometry;for(let n in r){let i=a.get(parseInt(n)),o=this.parseGeometry(i,r[n],e);t.set(parseInt(n),o)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){let a=r.skeletons,i=[],o=e.parents.map(function(e){return n.Objects.Model[e.ID]});if(0===o.length)return;let s=e.children.reduce(function(e,t){return void 0!==a[t.ID]&&(e=a[t.ID]),e},null);e.children.forEach(function(e){void 0!==r.morphTargets[e.ID]&&i.push(r.morphTargets[e.ID])});let l=o[0],u={};"RotationOrder"in l&&(u.eulerOrder=L(l.RotationOrder.value)),"InheritType"in l&&(u.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(u.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(u.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(u.scale=l.GeometricScaling.value);let c=E(u);return this.genGeometry(t,s,i,c)}genGeometry(e,t,r,n){let a=new s.BufferGeometry;e.attrName&&(a.name=e.attrName);let i=this.parseGeoNode(e,t),o=this.genBuffers(i),l=new s.Float32BufferAttribute(o.vertex,3);if(l.applyMatrix4(n),a.setAttribute("position",l),o.colors.length>0&&a.setAttribute("color",new s.Float32BufferAttribute(o.colors,3)),t&&(a.setAttribute("skinIndex",new s.Uint16BufferAttribute(o.weightsIndices,4)),a.setAttribute("skinWeight",new s.Float32BufferAttribute(o.vertexWeights,4)),a.FBX_Deformer=t),o.normal.length>0){let e=new(0,s.Matrix3)().getNormalMatrix(n),t=new s.Float32BufferAttribute(o.normal,3);t.applyNormalMatrix(e),a.setAttribute("normal",t)}if(o.uvs.forEach(function(e,t){let r="uv"+(t+1).toString();0===t&&(r="uv"),a.setAttribute(r,new s.Float32BufferAttribute(o.uvs[t],2))}),i.material&&"AllSame"!==i.material.mappingType){let e=o.materialIndex[0],t=0;if(o.materialIndex.forEach(function(r,n){r!==e&&(a.addGroup(t,n-t,e),e=r,t=n)}),a.groups.length>0){let t=a.groups[a.groups.length-1],r=t.start+t.count;r!==o.materialIndex.length&&a.addGroup(r,o.materialIndex.length-r,e)}0===a.groups.length&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,e,r,n),a}parseGeoNode(e,t){let r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(n,a){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[a]})})})),r}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,a=!1,i=[],o=[],s=[],l=[],u=[],c=[],p=this;return e.vertexIndices.forEach(function(f,h){let d;let m=!1;f<0&&(f^=-1,m=!0);let g=[],v=[];if(i.push(3*f,3*f+1,3*f+2),e.color){let t=b(h,r,f,e.color);s.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[f]&&e.weightTable[f].forEach(function(e){v.push(e.weight),g.push(e.id)}),v.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);let e=[0,0,0,0],t=[0,0,0,0];v.forEach(function(r,n){let a=r,i=g[n];t.forEach(function(t,r,n){if(a>t){n[r]=a,a=t;let o=e[r];e[r]=i,i=o}})}),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)u.push(v[e]),c.push(g[e])}if(e.normal){let t=b(h,r,f,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(d=b(h,r,f,e.material)[0])<0&&(p.negativeMaterialIndices=!0,d=0),e.uv&&e.uv.forEach(function(e,t){let n=b(h,r,f,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])}),n++,m&&(n>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),p.genFace(t,e,i,d,o,s,l,u,c,n),r++,n=0,i=[],o=[],s=[],l=[],u=[],c=[])}),t}genFace(e,t,r,n,a,i,o,s,l,u){for(let c=2;c<u;c++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[(c-1)*3]]),e.vertex.push(t.vertexPositions[r[(c-1)*3+1]]),e.vertex.push(t.vertexPositions[r[(c-1)*3+2]]),e.vertex.push(t.vertexPositions[r[3*c]]),e.vertex.push(t.vertexPositions[r[3*c+1]]),e.vertex.push(t.vertexPositions[r[3*c+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[(c-1)*4]),e.vertexWeights.push(s[(c-1)*4+1]),e.vertexWeights.push(s[(c-1)*4+2]),e.vertexWeights.push(s[(c-1)*4+3]),e.vertexWeights.push(s[4*c]),e.vertexWeights.push(s[4*c+1]),e.vertexWeights.push(s[4*c+2]),e.vertexWeights.push(s[4*c+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[(c-1)*4]),e.weightsIndices.push(l[(c-1)*4+1]),e.weightsIndices.push(l[(c-1)*4+2]),e.weightsIndices.push(l[(c-1)*4+3]),e.weightsIndices.push(l[4*c]),e.weightsIndices.push(l[4*c+1]),e.weightsIndices.push(l[4*c+2]),e.weightsIndices.push(l[4*c+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[(c-1)*3]),e.colors.push(i[(c-1)*3+1]),e.colors.push(i[(c-1)*3+2]),e.colors.push(i[3*c]),e.colors.push(i[3*c+1]),e.colors.push(i[3*c+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(a[0]),e.normal.push(a[1]),e.normal.push(a[2]),e.normal.push(a[(c-1)*3]),e.normal.push(a[(c-1)*3+1]),e.normal.push(a[(c-1)*3+2]),e.normal.push(a[3*c]),e.normal.push(a[3*c+1]),e.normal.push(a[3*c+2])),t.uv&&t.uv.forEach(function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][(c-1)*2]),e.uvs[r].push(o[r][(c-1)*2+1]),e.uvs[r].push(o[r][2*c]),e.uvs[r].push(o[r][2*c+1])})}addMorphTargets(e,t,r,a){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let i=this;r.forEach(function(r){r.rawTargets.forEach(function(r){let o=n.Objects.Geometry[r.geoID];void 0!==o&&i.genMorphGeometry(e,t,o,a,r.name)})})}genMorphGeometry(e,t,r,n,a){let i=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==r.Vertices?r.Vertices.a:[],l=void 0!==r.Indexes?r.Indexes.a:[],u=new Float32Array(3*e.attributes.position.count);for(let e=0;e<l.length;e++){let t=3*l[e];u[t]=o[3*e],u[t+1]=o[3*e+1],u[t+2]=o[3*e+2]}let c=this.genBuffers({vertexIndices:i,vertexPositions:u}),p=new s.Float32BufferAttribute(c.vertex,3);p.name=a||r.attrName,p.applyMatrix4(n),e.morphAttributes.position.push(p)}parseNormals(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,a=[];return"IndexToDirect"===r&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:a,mappingType:t,referenceType:r}}parseUVs(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,a=[];return"IndexToDirect"===r&&(a=e.UVIndex.a),{dataSize:2,buffer:n,indices:a,mappingType:t,referenceType:r}}parseVertexColors(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,a=[];"IndexToDirect"===r&&(a=e.ColorIndex.a);for(let e=0,t=new s.Color;e<n.length;e+=4)t.fromArray(n,e).convertSRGBToLinear().toArray(n,e);return{dataSize:4,buffer:n,indices:a,mappingType:t,referenceType:r}}parseMaterialIndices(e){let t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};let n=e.Materials.a,a=[];for(let e=0;e<n.length;++e)a.push(e);return{dataSize:1,buffer:n,indices:a,mappingType:t,referenceType:r}}parseNurbsGeometry(e){let t,r;let n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new s.BufferGeometry;let a=n-1,i=e.KnotVector.a,o=[],l=e.Points.a;for(let e=0,t=l.length;e<t;e+=4)o.push(new(0,s.Vector4)().fromArray(l,e));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){t=a,r=i.length-1-t;for(let e=0;e<a;++e)o.push(o[e])}let c=new u.NURBSCurve(a,i,o,t,r).getPoints(12*o.length);return new(0,s.BufferGeometry)().setFromPoints(c)}}class h{parse(){let e=[],t=this.parseClips();if(void 0!==t)for(let r in t){let n=t[r],a=this.addClip(n);e.push(a)}return e}parseClips(){if(void 0===n.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=n.Objects.AnimationCurveNode,t=new Map;for(let r in e){let n=e[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){let e={id:n.id,attr:n.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){let t=n.Objects.AnimationCurve;for(let r in t){let n={id:t[r].id,times:t[r].KeyTime.a.map(w),values:t[r].KeyValueFloat.a},i=a.get(n.id);if(void 0!==i){let t=i.parents[0].ID,r=i.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=n:r.match(/Y/)?e.get(t).curves.y=n:r.match(/Z/)?e.get(t).curves.z=n:r.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=n)}}}parseAnimationLayers(e){let t=n.Objects.AnimationLayer,r=new Map;for(let o in t){let t=[],l=a.get(parseInt(o));void 0!==l&&(l.children.forEach(function(r,o){if(e.has(r.ID)){let l=e.get(r.ID);if(void 0!==l.curves.x||void 0!==l.curves.y||void 0!==l.curves.z){if(void 0===t[o]){let e=a.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){let a=n.Objects.Model[e.toString()];if(void 0===a){console.warn("THREE.FBXLoader: Encountered a unused curve.",r);return}let l={modelName:a.attrName?(0,s.PropertyBinding).sanitizeNodeName(a.attrName):"",ID:a.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};i.traverse(function(e){e.ID===a.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))}),l.transform||(l.transform=new s.Matrix4),"PreRotation"in a&&(l.preRotation=a.PreRotation.value),"PostRotation"in a&&(l.postRotation=a.PostRotation.value),t[o]=l}}t[o]&&(t[o][l.attr]=l)}else if(void 0!==l.curves.morph){if(void 0===t[o]){let e=a.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,i=a.get(e).parents[0].ID,l=a.get(i).parents[0].ID,u=a.get(l).parents[0].ID,c=n.Objects.Model[u],p={modelName:c.attrName?(0,s.PropertyBinding).sanitizeNodeName(c.attrName):"",morphName:n.Objects.Deformer[e].attrName};t[o]=p}t[o][l.attr]=l}}}),r.set(parseInt(o),t))}return r}parseAnimStacks(e){let t=n.Objects.AnimationStack,r={};for(let n in t){let i=a.get(parseInt(n)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let o=e.get(i[0].ID);r[n]={name:t[n].attrName,layer:o}}return r}addClip(e){let t=[],r=this;return e.layer.forEach(function(e){t=t.concat(r.generateTracks(e))}),new s.AnimationClip(e.name,-1,t)}generateTracks(e){let t=[],r=new s.Vector3,n=new s.Quaternion,a=new s.Vector3;if(e.transform&&e.transform.decompose(r,n,a),r=r.toArray(),n=new(0,s.Euler)().setFromQuaternion(n,e.eulerOrder).toArray(),a=a.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){let n=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==n&&t.push(n)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){let r=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){let r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,n){let a=this.getTimesForAllAxes(t),i=this.getKeyframeTrackValues(a,t,r);return new s.VectorKeyframeTrack(e+"."+n,a,i)}generateRotationTrack(e,t,r,n,a,i){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(s.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(s.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(s.MathUtils.degToRad));let o=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(o,t,r);void 0!==n&&((n=n.map(s.MathUtils.degToRad)).push(i),n=new(0,s.Euler)().fromArray(n),n=new(0,s.Quaternion)().setFromEuler(n)),void 0!==a&&((a=a.map(s.MathUtils.degToRad)).push(i),a=new(0,s.Euler)().fromArray(a),a=new(0,s.Quaternion)().setFromEuler(a).invert());let u=new s.Quaternion,c=new s.Euler,p=[];for(let e=0;e<l.length;e+=3)c.set(l[e],l[e+1],l[e+2],i),u.setFromEuler(c),void 0!==n&&u.premultiply(n),void 0!==a&&u.multiply(a),u.toArray(p,e/3*4);return new s.QuaternionKeyframeTrack(e+".quaternion",o,p)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,r=t.values.map(function(e){return e/100}),n=i.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new s.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+n+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort(function(e,t){return e-t})).length>1){let e=1,r=t[0];for(let n=1;n<t.length;n++){let a=t[n];a!==r&&(t[e]=a,r=a,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){let n=[],a=-1,i=-1,o=-1;return e.forEach(function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(i=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==a){let e=t.x.values[a];n.push(e),r[0]=e}else n.push(r[0]);if(-1!==i){let e=t.y.values[i];n.push(e),r[1]=e}else n.push(r[1]);if(-1!==o){let e=t.z.values[o];n.push(e),r[2]=e}else n.push(r[2])}),n}interpolateRotations(e){for(let t=1;t<e.values.length;t++){let r=e.values[t-1],n=e.values[t]-r,a=Math.abs(n);if(a>=180){let i=a/180,o=n/i,s=r+o,l=e.times[t-1],u=(e.times[t]-l)/i,c=l+u,p=[],f=[];for(;c<e.times[t];)p.push(c),c+=u,f.push(s),s+=o;e.times=D(e.times,t,p),e.values=D(e.values,t,f)}}}}class d{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new v,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,r=e.split(/[\r\n]+/);return r.forEach(function(e,n){let a=e.match(/^[\s\t]*;/),i=e.match(/^[\s\t]*$/);if(a||i)return;let o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){let r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:r},i=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,a):r in o?("PoseNode"===r?o.PoseNode.push(a):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==i.id&&(o[r][i.id]=a)):"number"==typeof i.id?(o[r]={},o[r][i.id]=a):"Properties70"!==r&&("PoseNode"===r?o[r]=[a]:o[r]=a),"number"==typeof i.id&&(a.id=i.id),""!==i.name&&(a.attrName=i.name),""!==i.type&&(a.attrType=i.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];""!==e[0]&&isNaN(t=parseInt(e[0]))&&(t=e[0]);let r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}}parseNodeProperty(e,t,r){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===a&&(a=r.replace(/"/g,"").replace(/,$/,"").trim());let i=this.getCurrentNode();if("Properties70"===i.name){this.parseNodeSpecialProperty(e,n,a);return}if("C"===n){let e=a.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]),o=a.split(",").slice(3);o=o.map(function(e){return e.trim().replace(/^"/,"")}),n="connections",function(e,t){for(let r=0,n=e.length,a=t.length;r<a;r++,n++)e[n]=t[r]}(a=[t,r],o),void 0===i[n]&&(i[n]=[])}"Node"===n&&(i.id=a),n in i&&Array.isArray(i[n])?i[n].push(a):"a"!==n?i[n]=a:i.a=a,this.setCurrentProp(i,n),"a"===n&&","!==a.slice(-1)&&(i.a=A(a))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=A(t.a))}parseNodeSpecialProperty(e,t,r){let n=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=n[0],i=n[1],o=n[2],s=n[3],l=n[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=A(l)}this.getPrevNode()[a]={type:i,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),a)}}class m{parse(e){let t=new g(e);t.skip(23);let r=t.getUint32();if(r<6400)throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);let n=new v;for(;!this.endOfContent(t);){let e=this.parseNode(t,r);null!==e&&n.add(e.name,e)}return n}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let r={},n=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let i=e.getUint8(),o=e.getString(i);if(0===n)return null;let s=[];for(let t=0;t<a;t++)s.push(this.parseProperty(e));let l=s.length>0?s[0]:"",u=s.length>1?s[1]:"",c=s.length>2?s[2]:"";for(r.singleProperty=1===a&&e.getOffset()===n;n>e.getOffset();){let n=this.parseNode(e,t);null!==n&&this.parseSubNode(o,r,n)}return r.propertyList=s,"number"==typeof l&&(r.id=l),""!==u&&(r.attrName=u),""!==c&&(r.attrType=c),""!==o&&(r.name=o),r}parseSubNode(e,t,r){if(!0===r.singleProperty){let e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){let e=[];r.propertyList.forEach(function(t,r){0!==r&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name)Object.keys(r).forEach(function(e){t[e]=r[e]});else if("Properties70"===e&&"P"===r.name){let e,n=r.propertyList[0],a=r.propertyList[1],i=r.propertyList[2],o=r.propertyList[3];0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),e="Color"===a||"ColorRGB"===a||"Vector"===a||"Vector3D"===a||0===a.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[n]={type:a,type2:i,flag:o,value:e}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){let t;let r=e.getString(1);switch(r){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let n=e.getUint32(),a=e.getUint32(),i=e.getUint32();if(0===a)switch(r){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}let o=new g(l.unzlibSync(new Uint8Array(e.getArrayBuffer(i))).buffer);switch(r){case"b":case"c":return o.getBooleanArray(n);case"d":return o.getFloat64Array(n);case"f":return o.getFloat32Array(n);case"i":return o.getInt32Array(n);case"l":return o.getInt64Array(n)}break;default:throw Error("THREE.FBXLoader: Unknown property type "+r)}}}class g{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){let t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return(this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),0x80000000&t)?(t=0xffffffff&~t,0xffffffff==(e=0xffffffff&~e)&&(t=t+1&0xffffffff),-(0x100000000*t+(e=e+1&0xffffffff))):0x100000000*t+e}getInt64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),0x100000000*t+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=this.offset,r=new Uint8Array(this.dv.buffer,t,e);this.skip(e);let n=r.indexOf(0);return n>=0&&(r=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(r)}}class v{add(e,t){this[e]=t}}function y(e){let t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function w(e){return e/46186158e3}let x=[];function b(e,t,r,n){let a;switch(n.mappingType){case"ByPolygonVertex":a=e;break;case"ByPolygon":a=t;break;case"ByVertice":a=r;break;case"AllSame":a=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(a=n.indices[a]);let i=a*n.dataSize,o=i+n.dataSize;return function(e,t,r,n){for(let a=r,i=0;a<n;a++,i++)e[i]=t[a];return e}(x,n.buffer,i,o)}let I=new s.Euler,T=new s.Vector3;function E(e){let t=new s.Matrix4,r=new s.Matrix4,n=new s.Matrix4,a=new s.Matrix4,i=new s.Matrix4,o=new s.Matrix4,l=new s.Matrix4,u=new s.Matrix4,c=new s.Matrix4,p=new s.Matrix4,f=new s.Matrix4,h=new s.Matrix4,d=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(T.fromArray(e.translation)),e.preRotation){let t=e.preRotation.map(s.MathUtils.degToRad);t.push(e.eulerOrder||s.Euler.DEFAULT_ORDER),r.makeRotationFromEuler(I.fromArray(t))}if(e.rotation){let t=e.rotation.map(s.MathUtils.degToRad);t.push(e.eulerOrder||s.Euler.DEFAULT_ORDER),n.makeRotationFromEuler(I.fromArray(t))}if(e.postRotation){let t=e.postRotation.map(s.MathUtils.degToRad);t.push(e.eulerOrder||s.Euler.DEFAULT_ORDER),a.makeRotationFromEuler(I.fromArray(t)),a.invert()}e.scale&&i.scale(T.fromArray(e.scale)),e.scalingOffset&&l.setPosition(T.fromArray(e.scalingOffset)),e.scalingPivot&&o.setPosition(T.fromArray(e.scalingPivot)),e.rotationOffset&&u.setPosition(T.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(T.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(f.copy(e.parentMatrix),p.copy(e.parentMatrixWorld));let m=r.clone().multiply(n).multiply(a),g=new s.Matrix4;g.extractRotation(p);let v=new s.Matrix4;v.copyPosition(p);let y=v.clone().invert().multiply(p),w=g.clone().invert().multiply(y),x=new s.Matrix4;if(0===d)x.copy(g).multiply(m).multiply(w).multiply(i);else if(1===d)x.copy(g).multiply(w).multiply(m).multiply(i);else{let e=new(0,s.Matrix4)().scale(new(0,s.Vector3)().setFromMatrixScale(f)).clone().invert(),t=w.clone().multiply(e);x.copy(g).multiply(m).multiply(t).multiply(i)}let b=c.clone().invert(),E=o.clone().invert(),L=t.clone().multiply(u).multiply(c).multiply(r).multiply(n).multiply(a).multiply(b).multiply(l).multiply(o).multiply(i).multiply(E),A=new(0,s.Matrix4)().copyPosition(L),M=p.clone().multiply(A);return h.copyPosition(M),(L=h.clone().multiply(x)).premultiply(p.invert()),L}function L(e){return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),"ZYX"):["ZYX","YZX","XZY","ZXY","YXZ","XYZ"][e]}function A(e){return e.split(",").map(function(e){return parseFloat(e)})}function M(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),new TextDecoder().decode(new Uint8Array(e,t,r))}function D(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}}),s("79Zxq",function(e,t){r(e.exports,"unzlibSync",()=>$);/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var n={},a=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},i=function(e){return new Worker(e)};try{URL.revokeObjectURL(a(""))}catch(e){a=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},i=function(e){return new Worker(e,{type:"module"})}}var o=function(e,t,r,o,s){var l=i(n[t]||(n[t]=a(e)));return l.onerror=function(e){return s(e.error,null)},l.onmessage=function(e){return s(null,e.data)},l.postMessage(r,o),l},s=Uint8Array,l=Uint16Array,u=Uint32Array,c=new s([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),p=new s([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),f=new s([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=function(e,t){for(var r=new l(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var a=new u(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)a[i]=i-r[n]<<5|n;return[r,a]},d=h(c,2),m=d[0],g=d[1];m[28]=258,g[258]=28;for(var v=h(p,0),y=v[0],w=v[1],x=new l(32768),b=0;b<32768;++b){var I=(43690&b)>>>1|(21845&b)<<1;I=(61680&(I=(52428&I)>>>2|(13107&I)<<2))>>>4|(3855&I)<<4,x[b]=((65280&I)>>>8|(255&I)<<8)>>>1}for(var T=function(e,t,r){for(var n,a=e.length,i=0,o=new l(t);i<a;++i)++o[e[i]-1];var s=new l(t);for(i=0;i<t;++i)s[i]=s[i-1]+o[i-1]<<1;if(r){n=new l(1<<t);var u=15-t;for(i=0;i<a;++i)if(e[i])for(var c=i<<4|e[i],p=t-e[i],f=s[e[i]-1]++<<p,h=f|(1<<p)-1;f<=h;++f)n[x[f]>>>u]=c}else for(i=0,n=new l(a);i<a;++i)e[i]&&(n[i]=x[s[e[i]-1]++]>>>15-e[i]);return n},E=new s(288),b=0;b<144;++b)E[b]=8;for(var b=144;b<256;++b)E[b]=9;for(var b=256;b<280;++b)E[b]=7;for(var b=280;b<288;++b)E[b]=8;for(var L=new s(32),b=0;b<32;++b)L[b]=5;var A=/*#__PURE__*/T(E,9,0),M=/*#__PURE__*/T(E,9,1),D=/*#__PURE__*/T(L,5,0),P=/*#__PURE__*/T(L,5,1),k=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},R=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},F=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},C=function(e){return(e/8|0)+(7&e&&1)},O=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof l?l:e instanceof u?u:s)(r-t);return n.set(e.subarray(t,r)),n},N=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new s(0);var a=!t||r,i=!r||r.i;r||(r={}),t||(t=new s(3*n));var o=function(e){var r=t.length;if(e>r){var n=new s(Math.max(2*r,e));n.set(t),t=n}},l=r.f||0,u=r.p||0,h=r.b||0,d=r.l,g=r.d,v=r.m,w=r.n,x=8*n;do{if(!d){r.f=l=R(e,u,1);var b=R(e,u+1,3);if(u+=3,b){if(1==b)d=M,g=P,v=9,w=5;else if(2==b){var I=R(e,u,31)+257,E=R(e,u+10,15)+4,L=I+R(e,u+5,31)+1;u+=14;for(var A=new s(L),D=new s(19),N=0;N<E;++N)D[f[N]]=R(e,u+3*N,7);u+=3*E;for(var S=k(D),B=(1<<S)-1,U=T(D,S,1),N=0;N<L;){var V=U[R(e,u,B)];u+=15&V;var j=V>>>4;if(j<16)A[N++]=j;else{var G=0,X=0;for(16==j?(X=3+R(e,u,3),u+=2,G=A[N-1]):17==j?(X=3+R(e,u,7),u+=3):18==j&&(X=11+R(e,u,127),u+=7);X--;)A[N++]=G}}var W=A.subarray(0,I),z=A.subarray(I);v=k(W),w=k(z),d=T(W,v,1),g=T(z,w,1)}else throw"invalid block type"}else{var j=C(u)+4,_=e[j-4]|e[j-3]<<8,H=j+_;if(H>n){if(i)throw"unexpected EOF";break}a&&o(h+_),t.set(e.subarray(j,H),h),r.b=h+=_,r.p=u=8*H;continue}if(u>x){if(i)throw"unexpected EOF";break}}a&&o(h+131072);for(var q=(1<<v)-1,K=(1<<w)-1,Z=u;;Z=u){var G=d[F(e,u)&q],Y=G>>>4;if((u+=15&G)>x){if(i)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if(Y<256)t[h++]=Y;else if(256==Y){Z=u,d=null;break}else{var Q=Y-254;if(Y>264){var N=Y-257,$=c[N];Q=R(e,u,(1<<$)-1)+m[N],u+=$}var J=g[F(e,u)&K],ee=J>>>4;if(!J)throw"invalid distance";u+=15&J;var z=y[ee];if(ee>3){var $=p[ee];z+=F(e,u)&(1<<$)-1,u+=$}if(u>x){if(i)throw"unexpected EOF";break}a&&o(h+131072);for(var et=h+Q;h<et;h+=4)t[h]=t[h-z],t[h+1]=t[h+1-z],t[h+2]=t[h+2-z],t[h+3]=t[h+3-z];h=et}}r.l=d,r.p=Z,r.b=h,d&&(l=1,r.m=v,r.d=g,r.n=w)}while(!l)return h==t.length?t:O(t,0,h)},S=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8},B=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},U=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,i=r.slice();if(!a)return[_,0];if(1==a){var o=new s(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var u=r[0],c=r[1],p=0,f=1,h=2;for(r[0]={s:-1,f:u.f+c.f,l:u,r:c};f!=a-1;)u=r[r[p].f<r[h].f?p++:h++],c=r[p!=f&&r[p].f<r[h].f?p++:h++],r[f++]={s:-1,f:u.f+c.f,l:u,r:c};for(var d=i[0].s,n=1;n<a;++n)i[n].s>d&&(d=i[n].s);var m=new l(d+1),g=V(r[f-1],m,0);if(g>t){var n=0,v=0,y=g-t,w=1<<y;for(i.sort(function(e,t){return m[t.s]-m[e.s]||e.f-t.f});n<a;++n){var x=i[n].s;if(m[x]>t)v+=w-(1<<g-m[x]),m[x]=t;else break}for(v>>>=y;v>0;){var b=i[n].s;m[b]<t?v-=1<<t-m[b]++-1:++n}for(;n>=0&&v;--n){var I=i[n].s;m[I]==t&&(--m[I],++v)}g=t}return[new s(m),g]},V=function(e,t,r){return -1==e.s?Math.max(V(e.l,t,r+1),V(e.r,t,r+1)):t[e.s]=r},j=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new l(++t),n=0,a=e[0],i=1,o=function(e){r[n++]=e},s=1;s<=t;++s)if(e[s]==a&&s!=t)++i;else{if(!a&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(a),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(a);i=1,a=e[s]}return[r.subarray(0,n),t]},G=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},X=function(e,t,r){var n=r.length,a=C(t+2);e[a]=255&n,e[a+1]=n>>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var i=0;i<n;++i)e[a+i+4]=r[i];return(a+4+n)*8},W=function(e,t,r,n,a,i,o,s,u,h,d){S(t,d++,r),++a[256];for(var m,g,v,y,w=U(a,15),x=w[0],b=w[1],I=U(i,15),M=I[0],P=I[1],k=j(x),R=k[0],F=k[1],C=j(M),O=C[0],N=C[1],V=new l(19),W=0;W<R.length;++W)V[31&R[W]]++;for(var W=0;W<O.length;++W)V[31&O[W]]++;for(var z=U(V,7),_=z[0],H=z[1],q=19;q>4&&!_[f[q-1]];--q);var K=h+5<<3,Z=G(a,E)+G(i,L)+o,Y=G(a,x)+G(i,M)+o+14+3*q+G(V,_)+(2*V[16]+3*V[17]+7*V[18]);if(K<=Z&&K<=Y)return X(t,d,e.subarray(u,u+h));if(S(t,d,1+(Y<Z)),d+=2,Y<Z){m=T(x,b,0),g=x,v=T(M,P,0),y=M;var Q=T(_,H,0);S(t,d,F-257),S(t,d+5,N-1),S(t,d+10,q-4),d+=14;for(var W=0;W<q;++W)S(t,d+3*W,_[f[W]]);d+=3*q;for(var $=[R,O],J=0;J<2;++J)for(var ee=$[J],W=0;W<ee.length;++W){var et=31&ee[W];S(t,d,Q[et]),d+=_[et],et>15&&(S(t,d,ee[W]>>>5&127),d+=ee[W]>>>12)}}else m=A,g=E,v=D,y=L;for(var W=0;W<s;++W)if(n[W]>255){var et=n[W]>>>18&31;B(t,d,m[et+257]),d+=g[et+257],et>7&&(S(t,d,n[W]>>>23&31),d+=c[et]);var er=31&n[W];B(t,d,v[er]),d+=y[er],er>3&&(B(t,d,n[W]>>>5&8191),d+=p[er])}else B(t,d,m[n[W]]),d+=g[n[W]];return B(t,d,m[256]),d+g[256]},z=/*#__PURE__*/new u([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),_=/*#__PURE__*/new s(0),H=function(e,t,r,n,a,i){var o=e.length,f=new s(n+o+5*(1+Math.ceil(o/7e3))+a),h=f.subarray(n,f.length-a),d=0;if(!t||o<8)for(var m=0;m<=o;m+=65535){var v=m+65535;v<o?d=X(h,d,e.subarray(m,v)):(h[m]=i,d=X(h,d,e.subarray(m,o)))}else{for(var y=z[t-1],x=y>>>13,b=8191&y,I=(1<<r)-1,T=new l(32768),E=new l(I+1),L=Math.ceil(r/3),A=2*L,M=function(t){return(e[t]^e[t+1]<<L^e[t+2]<<A)&I},D=new u(25e3),P=new l(288),k=new l(32),R=0,F=0,m=0,N=0,S=0,B=0;m<o;++m){var U=M(m),V=32767&m,j=E[U];if(T[V]=j,E[U]=V,S<=m){var G=o-m;if((R>7e3||N>24576)&&G>423){d=W(e,h,0,D,P,k,F,N,B,m-B,d),N=R=F=0,B=m;for(var H=0;H<286;++H)P[H]=0;for(var H=0;H<30;++H)k[H]=0}var q=2,K=0,Z=b,Y=V-j&32767;if(G>2&&U==M(m-Y))for(var Q=Math.min(x,G)-1,$=Math.min(32767,m),J=Math.min(258,G);Y<=$&&--Z&&V!=j;){if(e[m+q]==e[m+q-Y]){for(var ee=0;ee<J&&e[m+ee]==e[m+ee-Y];++ee);if(ee>q){if(q=ee,K=Y,ee>Q)break;for(var et=Math.min(Y,ee-2),er=0,H=0;H<et;++H){var en=m-Y+H+32768&32767,ea=T[en],ei=en-ea+32768&32767;ei>er&&(er=ei,j=en)}}}j=T[V=j],Y+=V-j+32768&32767}if(K){D[N++]=0x10000000|g[q]<<18|w[K];var eo=31&g[q],es=31&w[K];F+=c[eo]+p[es],++P[257+eo],++k[es],S=m+q,++R}else D[N++]=e[m],++P[e[m]]}}d=W(e,h,i,D,P,k,F,N,B,m-B,d),!i&&7&d&&(d=X(h,d+1,_))}return O(f,0,n+C(d)+a)},q=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},K=function(e,t,r){for(var n=e(),a=e.toString(),i=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var s=n[o],l=i[o];if("function"==typeof s){t+=";"+l+"=";var u=s.toString();if(s.prototype){if(-1!=u.indexOf("[native code]")){var c=u.indexOf(" ",8)+1;t+=u.slice(c,u.indexOf("(",c))}else for(var p in t+=u,s.prototype)t+=";"+l+".prototype."+p+"="+s.prototype[p].toString()}else t+=u}else r[l]=s}return[t,r]},Z=[],Y=function(e){var t=[];for(var r in e)(e[r]instanceof s||e[r]instanceof l||e[r]instanceof u)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t},Q=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function $(e,t){return N((Q(e),e.subarray(2,-4)),t)}var J="undefined"!=typeof TextDecoder&&/*#__PURE__*/new TextDecoder;try{J.decode(_,{stream:!0})}catch(e){}}),s("cLt9Z",function(e,t){r(e.exports,"NURBSCurve",()=>i);var n=o("ilwiq"),a=o("5joV2");class i extends n.Curve{constructor(e,t,r,a,i){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=a||0,this.endKnot=i||this.knots.length-1;for(let e=0;e<r.length;++e){let t=r[e];this.controlPoints[e]=new n.Vector4(t.x,t.y,t.z,t.w)}}getPoint(e,t=new n.Vector3){let r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=a.calcBSplinePoint(this.degree,this.knots,this.controlPoints,r);return 1!==i.w&&i.divideScalar(i.w),t.set(i.x,i.y,i.z)}getTangent(e,t=new n.Vector3){let r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=a.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,r,1);return t.copy(i[1]).normalize(),t}}}),s("5joV2",function(e,t){r(e.exports,"calcBSplinePoint",()=>i),r(e.exports,"calcNURBSDerivatives",()=>s);var n=o("ilwiq");function a(e,t,r){let n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;let a=e,i=n,o=Math.floor((a+i)/2);for(;t<r[o]||t>=r[o+1];)t<r[o]?i=o:a=o,o=Math.floor((a+i)/2);return o}function i(e,t,r,i){let o=a(e,i,t),s=function(e,t,r,n){let a=[],i=[],o=[];a[0]=1;for(let s=1;s<=r;++s){i[s]=t-n[e+1-s],o[s]=n[e+s]-t;let r=0;for(let e=0;e<s;++e){let t=o[e+1],n=i[s-e],l=a[e]/(t+n);a[e]=r+t*l,r=n*l}a[s]=r}return a}(o,i,e,t),l=new n.Vector4(0,0,0,0);for(let t=0;t<=e;++t){let n=r[o-e+t],a=s[t],i=n.w*a;l.x+=n.x*i,l.y+=n.y*i,l.z+=n.z*i,l.w+=n.w*a}return l}function s(e,t,r,i,o){return function(e){let t=e.length,r=[],a=[];for(let i=0;i<t;++i){let t=e[i];r[i]=new n.Vector3(t.x,t.y,t.z),a[i]=t.w}let i=[];for(let e=0;e<t;++e){let t=r[e].clone();for(let r=1;r<=e;++r)t.sub(i[e-r].clone().multiplyScalar(function(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let n=1;for(let e=2;e<=t;++e)n*=e;for(let r=2;r<=e-t;++r)n*=r;return r/n}(e,r)*a[r]));i[e]=t.divideScalar(a[0])}return i}(function(e,t,r,i,o){let s=o<e?o:e,l=[],u=a(e,i,t),c=function(e,t,r,n,a){let i=[];for(let e=0;e<=r;++e)i[e]=0;let o=[];for(let e=0;e<=n;++e)o[e]=i.slice(0);let s=[];for(let e=0;e<=r;++e)s[e]=i.slice(0);s[0][0]=1;let l=i.slice(0),u=i.slice(0);for(let n=1;n<=r;++n){l[n]=t-a[e+1-n],u[n]=a[e+n]-t;let r=0;for(let e=0;e<n;++e){let t=u[e+1],a=l[n-e];s[n][e]=t+a;let i=s[e][n-1]/s[n][e];s[e][n]=r+t*i,r=a*i}s[n][n]=r}for(let e=0;e<=r;++e)o[0][e]=s[e][r];for(let e=0;e<=r;++e){let t=0,a=1,l=[];for(let e=0;e<=r;++e)l[e]=i.slice(0);l[0][0]=1;for(let i=1;i<=n;++i){let n=0,u=e-i,c=r-i;e>=i&&(l[a][0]=l[t][0]/s[c+1][u],n=l[a][0]*s[u][c]);let p=u>=-1?1:-u,f=e-1<=c?i-1:r-e;for(let e=p;e<=f;++e)l[a][e]=(l[t][e]-l[t][e-1])/s[c+1][u+e],n+=l[a][e]*s[u+e][c];e<=c&&(l[a][i]=-l[t][i-1]/s[c+1][e],n+=l[a][i]*s[e][c]),o[i][e]=n;let h=t;t=a,a=h}}let c=r;for(let e=1;e<=n;++e){for(let t=0;t<=r;++t)o[e][t]*=c;c*=r-e}return o}(u,i,e,s,t),p=[];for(let e=0;e<r.length;++e){let t=r[e].clone(),n=t.w;t.x*=n,t.y*=n,t.z*=n,p[e]=t}for(let t=0;t<=s;++t){let r=p[u-e].clone().multiplyScalar(c[t][0]);for(let n=1;n<=e;++n)r.add(p[u-e+n].clone().multiplyScalar(c[t][n]));l[t]=r}for(let e=s+1;e<=o+1;++e)l[e]=new n.Vector4(0,0,0);return l}(e,t,r,i,o))}});var l=o("ilwiq"),u=o("qgTqt");const c=new l.Clock,p=document.getElementById("second-canvas");p.setAttribute("width","640px"),p.setAttribute("height","640px");const f=new l.Scene,h=new l.PerspectiveCamera(75,p.clientWidth/p.clientHeight,.1,1e3),d=new l.WebGLRenderer({antialias:!0,canvas:p});h.position.set(0,5.5,2.5),h.rotateY(.2);var m=new l.DirectionalLight("white",.5);m.position.set(1,1,1),f.add(m);var g=new l.AmbientLight("white",.5);f.add(g),f.background=new l.Color(7504030),Promise.all([new Promise((e,r)=>{new u.FBXLoader().load("./assets/low_poly_man.fbx",r=>{r.scale.setScalar(.01),r.traverse(e=>{e.castShadow=!0}),t=r.getObjectByName("mixamorigHead"),e(r)})}),new Promise((e,t)=>{new u.FBXLoader().load("./assets/Waving.fbx",t=>{e(t)})}),new Promise((e,t)=>{new u.FBXLoader().load("./assets/Arm Stretching.fbx",t=>{e(t)})})]).then(t=>{f.add(t[0]),e=new l.AnimationMixer(t[0]),t[0].animations=t[1].animation;let r=e.clipAction(t[1].animations[0]);r._clip.name="waving";let n=e.clipAction(t[2].animations[0]);n._clip.name="armstretching",r.play(),n.loop=l.LoopOnce;let a=0;e.addEventListener("finished",function(e){"waving"==e.action._clip.name&&a<5?(a++,r.reset(),r.play(),4==a&&(a=0,r.stop(),n.play())):"armstretching"==e.action._clip.name&&(n.stop(),r.play())})});const v=new l.Object3D,y=new l.Vector2;v.position.set(.2,5.2,2),window.addEventListener("mousemove",e=>{y.x=2*(e.clientX/window.innerWidth*2-1),y.y=-2*(e.clientY/window.innerHeight)*2+7,v.position.set(y.x,y.y,2)}),function r(){let n=c.getDelta();e&&e.update(n),t&&t.lookAt(v.position),requestAnimationFrame(r),d.render(f,h)}();
//# sourceMappingURL=index.bbb11a13.js.map
